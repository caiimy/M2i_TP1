---
- hosts: wordpress
  become: true

  vars:
    httpd_server_root: /etc/apache2

  tasks:
  - name: Install Apache
    apt:
      name: apache2
      state: present

  - name: Install PHP
    apt:
      name: php
      state: present

  - name: Configure Apache
    lineinfile:
      path: "{{ httpd_server_root }}/apache2.conf"
      regexp: '^Listen '
      line: Listen 80

  - name: Copy Apache default config
    copy:
      src: files/000-default.conf
      dest: "{{ httpd_server_root }}/sites-available/000-default.conf"
    notify:
      - restart apache

  - name: Enable Apache site
    command: a2ensite 000-default.conf
    notify:
     - restart apache

  - name: Install MySQL
    apt:
      name: mysql-server
      state: present

  - name: Download WordPress
    unarchive:
      src: https://wordpress.org/latest.tar.gz
      dest: /var/www/html
      remote_src: yes

  handlers:
    - name: restart apache
      service: 
        name: apache2
        state: restarted